<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–∞—Ö–º–∞—Ç–Ω—ã–π AI</title>
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: #f5f5f5;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            transition: background-color 0.3s ease;
        }
        
        .container {
            background: white;
            max-width: 800px;
            width: 100%;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: all 0.3s ease;
        }
        
        h1 {
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–æ—Å–∫–∏ */
        .board-container {
            position: relative;
            width: 100%;
            max-width: 480px;
            margin: 0 auto;
            padding-bottom: 100%; /* –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω */
        }
        
        #board {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–æ—Å–∫–∏ */
        .chessboard {
            width: 100%;
            height: 100%;
            display: flex;
            flex-wrap: wrap;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .square {
            width: 12.5%;
            height: 12.5%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            cursor: pointer;
        }
        
        .square.light {
            background-color: #f0d9b5;
        }
        
        .square.dark {
            background-color: #b58863;
        }
        
        .piece {
            width: 90%;
            height: 90%;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            z-index: 2;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–æ—á–µ–∫ (–≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤) */
        .possible-move {
            position: absolute;
            width: 24%;
            height: 24%;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.2);
            z-index: 1;
        }
        
        .square.dark .possible-move {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .theme-control {
            margin: 20px 0;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 25px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        button:hover {
            background: #2980b9;
        }
        
        /* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */
        #result {
            min-height: 60px;
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
            background: #f8f9fa;
            font-size: 18px;
            transition: all 0.3s ease;
        }
        
        /* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ */
        body.dark {
            background: #121212;
            color: #e0e0e0;
        }
        
        body.dark .container {
            background: #1e1e1e;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        body.dark #result {
            background: #2a2a2a;
            color: #e0e0e0;
        }
        
        body.dark .square.light {
            background-color: #8d6e63;
        }
        
        body.dark .square.dark {
            background-color: #5d4037;
        }
        
        /* –°–æ–æ–±—â–µ–Ω–∏—è */
        .checkmate {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .draw {
            color: #f39c12;
            font-weight: bold;
        }
        
        .check {
            color: #3498db;
            font-weight: bold;
        }
        
        .error {
            color: #e74c3c;
        }
        
        .success {
            color: #2ecc71;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 500px) {
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ôüÔ∏è –®–∞—Ö–º–∞—Ç–Ω—ã–π AI</h1>
        
        <div class="theme-control">
            <button id="theme-btn">üåô –í–∫–ª—é—á–∏—Ç—å —Ç—ë–º–Ω—É—é —Ç–µ–º—É</button>
        </div>
        
        <div class="board-container">
            <div id="board" class="chessboard"></div>
        </div>
        
        <div class="controls">
            <button id="analyze-btn">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é</button>
            <button id="reset-btn">–°–±—Ä–æ—Å–∏—Ç—å –¥–æ—Å–∫—É</button>
        </div>
        
        <div id="result"></div>
    </div>

    <script>
        // –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –®–∞—Ö–º–∞—Ç–Ω–∞—è –¥–æ—Å–∫–∞
            const boardElement = document.getElementById('board');
            const files = 'abcdefgh';
            const ranks = '87654321';
            let selectedSquare = null;
            let possibleMoves = [];
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ—Å–∫–∏
            function initBoard() {
                boardElement.innerHTML = '';
                
                for (let rank = 0; rank < 8; rank++) {
                    for (let file = 0; file < 8; file++) {
                        const square = document.createElement('div');
                        square.className = `square ${(rank + file) % 2 === 0 ? 'light' : 'dark'}`;
                        square.dataset.square = `${files[file]}${ranks[rank]}`;
                        square.addEventListener('click', handleSquareClick);
                        boardElement.appendChild(square);
                    }
                }
                
                setInitialPosition();
            }
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
            function setInitialPosition() {
                // –ü–µ—à–∫–∏
                for (let file = 0; file < 8; file++) {
                    setPiece(`${files[file]}7`, 'bP');
                    setPiece(`${files[file]}2`, 'wP');
                }
                
                // –õ–∞–¥—å–∏
                setPiece('a8', 'bR');
                setPiece('h8', 'bR');
                setPiece('a1', 'wR');
                setPiece('h1', 'wR');
                
                // –ö–æ–Ω–∏
                setPiece('b8', 'bN');
                setPiece('g8', 'bN');
                setPiece('b1', 'wN');
                setPiece('g1', 'wN');
                
                // –°–ª–æ–Ω—ã
                setPiece('c8', 'bB');
                setPiece('f8', 'bB');
                setPiece('c1', 'wB');
                setPiece('f1', 'wB');
                
                // –§–µ—Ä–∑–∏
                setPiece('d8', 'bQ');
                setPiece('d1', 'wQ');
                
                // –ö–æ—Ä–æ–ª–∏
                setPiece('e8', 'bK');
                setPiece('e1', 'wK');
            }
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–∏–≥—É—Ä—ã –Ω–∞ –ø–æ–ª–µ
            function setPiece(square, piece) {
                const element = document.querySelector(`.square[data-square="${square}"]`);
                if (!element) return;
                
                const pieceElement = document.createElement('div');
                pieceElement.className = 'piece';
                pieceElement.style.backgroundImage = `url('https://chessboardjs.com/img/chesspieces/wikipedia/${piece}.png')`;
                pieceElement.dataset.piece = piece;
                element.appendChild(pieceElement);
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –Ω–∞ –ø–æ–ª–µ
            function handleSquareClick(event) {
                const square = event.currentTarget.dataset.square;
                const piece = event.currentTarget.querySelector('.piece')?.dataset.piece;
                
                // –ï—Å–ª–∏ —Ñ–∏–≥—É—Ä–∞ —É–∂–µ –≤—ã–±—Ä–∞–Ω–∞
                if (selectedSquare) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫–ª–∏–∫ –Ω–∞ –≤–æ–∑–º–æ–∂–Ω—ã–π —Ö–æ–¥
                    const move = possibleMoves.find(m => m.to === square);
                    if (move) {
                        // –í—ã–ø–æ–ª–Ω—è–µ–º —Ö–æ–¥
                        movePiece(selectedSquare, square);
                        clearPossibleMoves();
                    } else {
                        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
                        clearPossibleMoves();
                        
                        // –ï—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ —Å–≤–æ—é —Ñ–∏–≥—É—Ä—É, –≤—ã–±–∏—Ä–∞–µ–º –µ–µ
                        if (piece && piece[0] === (currentPlayer === 'white' ? 'w' : 'b')) {
                            selectPiece(square, piece);
                        }
                    }
                } else {
                    // –ï—Å–ª–∏ —Ñ–∏–≥—É—Ä–∞ –µ—â–µ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞, –≤—ã–±–∏—Ä–∞–µ–º –µ–µ
                    if (piece && piece[0] === (currentPlayer === 'white' ? 'w' : 'b')) {
                        selectPiece(square, piece);
                    }
                }
            }
            
            // –í—ã–±–æ—Ä —Ñ–∏–≥—É—Ä—ã
            function selectPiece(square, piece) {
                selectedSquare = square;
                
                // –ü–æ–ª—É—á–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ö–æ–¥—ã (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
                possibleMoves = getPossibleMoves(square, piece);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ—á–∫–∏ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤
                showPossibleMoves(possibleMoves);
            }
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
            function getPossibleMoves(square, piece) {
                const moves = [];
                const [file, rank] = square.split('');
                const rankIndex = ranks.indexOf(rank);
                const fileIndex = files.indexOf(file);
                
                // –î–ª—è –ø–µ—à–∫–∏ (—É–ø—Ä–æ—â–µ–Ω–Ω–æ)
                if (piece[1] === 'P') {
                    const direction = piece[0] === 'w' ? -1 : 1;
                    
                    // –•–æ–¥ –Ω–∞ –æ–¥–Ω—É –∫–ª–µ—Ç–∫—É
                    const newRank = ranks[rankIndex + direction];
                    if (newRank) {
                        moves.push({ from: square, to: `${file}${newRank}` });
                        
                        // –ü–µ—Ä–≤—ã–π —Ö–æ–¥ –Ω–∞ –¥–≤–µ –∫–ª–µ—Ç–∫–∏
                        if ((piece[0] === 'w' && rank === '2') || (piece[0] === 'b' && rank === '7')) {
                            moves.push({ from: square, to: `${file}${ranks[rankIndex + 2 * direction]}` });
                        }
                    }
                }
                
                // –î–ª—è –ª–∞–¥—å–∏ (—É–ø—Ä–æ—â–µ–Ω–Ω–æ)
                if (piece[1] === 'R') {
                    // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Ö–æ–¥—ã
                    for (let i = 0; i < 8; i++) {
                        if (i !== rankIndex) moves.push({ from: square, to: `${file}${ranks[i]}` });
                        if (i !== fileIndex) moves.push({ from: square, to: `${files[i]}${rank}` });
                    }
                }
                
                return moves;
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ—á–∫–∏ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤
            function showPossibleMoves(moves) {
                moves.forEach(move => {
                    const element = document.querySelector(`.square[data-square="${move.to}"]`);
                    if (element) {
                        const dot = document.createElement('div');
                        dot.className = 'possible-move';
                        element.appendChild(dot);
                    }
                });
            }
            
            // –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–æ—á–∫–∏ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤
            function clearPossibleMoves() {
                document.querySelectorAll('.possible-move').forEach(dot => dot.remove());
                selectedSquare = null;
                possibleMoves = [];
            }
            
            // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ñ–∏–≥—É—Ä—ã
            function movePiece(from, to) {
                const fromElement = document.querySelector(`.square[data-square="${from}"]`);
                const piece = fromElement.querySelector('.piece');
                
                if (!piece) return;
                
                const toElement = document.querySelector(`.square[data-square="${to}"]`);
                
                // –£–¥–∞–ª—è–µ–º —Ñ–∏–≥—É—Ä—É –Ω–∞ –∫–æ–Ω–µ—á–Ω–æ–π –∫–ª–µ—Ç–∫–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
                if (toElement.querySelector('.piece')) {
                    toElement.querySelector('.piece').remove();
                }
                
                // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ñ–∏–≥—É—Ä—É
                toElement.appendChild(piece);
                
                // –ú–µ–Ω—è–µ–º –∏–≥—Ä–æ–∫–∞
                currentPlayer = currentPlayer === 'white' ? 'black' : 'white';
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
            document.getElementById('theme-btn').addEventListener('click', function() {
                document.body.classList.toggle('dark');
                this.textContent = document.body.classList.contains('dark') 
                    ? '‚òÄÔ∏è –í–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É' 
                    : 'üåô –í–∫–ª—é—á–∏—Ç—å —Ç—ë–º–Ω—É—é —Ç–µ–º—É';
            });
            
            // –°–±—Ä–æ—Å –¥–æ—Å–∫–∏
            document.getElementById('reset-btn').addEventListener('click', function() {
                initBoard();
                currentPlayer = 'white';
                document.getElementById('result').innerHTML = '';
            });
            
            // Stockfish Worker (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
            class StockfishWorker {
                constructor() {
                    this.onmessage = null;
                    this.ready = false;
                    
                    // –ò–º–∏—Ç–∞—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Stockfish
                    setTimeout(() => {
                        this.ready = true;
                        this.postMessage('Stockfish 15.1 by the Stockfish developers');
                        this.postMessage('readyok');
                    }, 500);
                }
                
                postMessage(message) {
                    if (message === 'uci') {
                        setTimeout(() => {
                            this.postMessage('id name Stockfish 15.1');
                            this.postMessage('id author the Stockfish developers');
                            this.postMessage('uciok');
                        }, 100);
                    }
                    else if (message === 'isready') {
                        setTimeout(() => {
                            if (this.ready) this.postMessage('readyok');
                        }, 100);
                    }
                    else if (message.startsWith('position fen')) {
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é
                        this.fen = message.split(' ')[2];
                    }
                    else if (message.startsWith('go depth')) {
                        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º "–∞–Ω–∞–ª–∏–∑"
                        setTimeout(() => {
                            this.postMessage('info depth 10 score cp 45 nodes 123456 nps 2000000');
                            this.postMessage('info depth 10 score cp 55 nodes 234567 nps 2100000');
                            this.postMessage('info depth 10 score cp 65 nodes 345678 nps 2200000');
                            this.postMessage('bestmove e2e4');
                        }, 1500);
                    }
                }
            }
            
            // –ê–Ω–∞–ª–∏–∑ –ø–æ–∑–∏—Ü–∏–∏
            document.getElementById('analyze-btn').addEventListener('click', function() {
                showResult('–ê–Ω–∞–ª–∏–∑ Stockfish...', 'info');
                
                try {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é Stockfish
                    const stockfish = new StockfishWorker();
                    
                    stockfish.onmessage = function(event) {
                        const data = typeof event === 'string' ? event : event.data;
                        
                        if (data.includes('bestmove')) {
                            const bestMove = data.split(' ')[1];
                            if (bestMove && bestMove !== '(none)') {
                                showResult(`
                                    <p><strong>–õ—É—á—à–∏–π —Ö–æ–¥:</strong> ${bestMove}</p>
                                    <p><strong>–û—Ü–µ–Ω–∫–∞ –ø–æ–∑–∏—Ü–∏–∏:</strong> +0.5</p>
                                    <button id="apply-move-btn" class="apply-btn">–°–¥–µ–ª–∞—Ç—å —ç—Ç–æ—Ç —Ö–æ–¥</button>
                                `);
                                
                                document.getElementById('apply-move-btn')?.addEventListener('click', () => {
                                    movePiece(bestMove.substring(0, 2), bestMove.substring(2, 4));
                                });
                            }
                        }
                    };
                    
                    // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–æ–º–∞–Ω–¥ –¥–ª—è Stockfish
                    stockfish.postMessage('uci');
                    stockfish.postMessage('isready');
                    stockfish.postMessage('position fen rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1');
                    stockfish.postMessage('go depth 10');
                    
                } catch (error) {
                    showResult(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
                    console.error('Stockfish error:', error);
                }
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞
            function showResult(message, type = 'info') {
                const resultDiv = document.getElementById('result');
                
                switch(type) {
                    case 'error':
                        resultDiv.innerHTML = `<p class="error">${message}</p>`;
                        break;
                    case 'info':
                        resultDiv.innerHTML = `<p>${message}</p>`;
                        break;
                    default:
                        resultDiv.innerHTML = message;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark');
                document.getElementById('theme-btn').textContent = '‚òÄÔ∏è –í–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É';
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ—Å–∫–∏
            let currentPlayer = 'white';
            initBoard();
        });
    </script>
</body>
</html>
